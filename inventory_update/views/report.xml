<odoo>
<template id="stock_report_delivery_document_inherit_udates" inherit_id="product_expiry.stock_report_delivery_document_inherit_product_expiry">
        <xpath expr="//t[@name='expiry_date']" position="replace">
            <t t-set="has_expiry_date" t-value="False"/>
            <t t-set="has_expiry_date"
               t-value="o.move_line_ids.filtered(lambda ml: ml.lot_id.expiration_date or ml.expiration_date)"
               groups="product_expiry.group_expiry_date_on_delivery_slip"/>
            <t t-set="has_box_date" t-value="False"/>
            <t t-set="has_box_date"
               t-value="o.move_line_ids.filtered(lambda ml: ml.box_no)"
               />
            <t t-set="has_batch_date" t-value="False"/>
            <t t-set="has_batch_date"
               t-value="o.move_line_ids.filtered(lambda ml: ml.lot_id.ref or ml.suplier_lot or ml.lot_id.suplier_lot)"
               />
            <t t-set="public_price"
               t-value="o.picking_type_id.code=='internal' and o.move_line_ids.filtered(lambda ml: ml.product_id.pubprice)"
               />

            <t name="box_date" t-if="has_box_date">
                <th>Box Weight/Qty</th>
            </t>
            <t name="box_no_date" t-if="has_box_date">
                <th>No of Boxes</th>
            </t>
            <t name="expiry_date" t-if="has_expiry_date">
                <th>Production Date</th>
            </t>
            <t name="expiry_date" t-if="has_expiry_date">
                <th>Expiration Date</th>

            </t>
            <t name="batch_date" t-if="has_batch_date">
                <th>Batch NO</th>

            </t> <t name="public" t-if="public_price">
                <th>Public Price</th>

            </t>
        </xpath>
    </template>

    <template id="stock_report_delivery_has_serial_move_line_inherit_product_expiry" inherit_id="product_expiry.stock_report_delivery_has_serial_move_line_inherit_product_expiry">
        <xpath expr="//t[@t-if='has_expiry_date']" position="replace">
            <t t-if="has_box_date">
                <td><span t-field="move_line.box_no"/></td>
            </t>
            <t t-if="has_box_date">
                <td><span t-field="move_line.box_qty" /></td>
            </t>
             <t t-if="has_expiry_date">
                <td><span t-if="move_line.lot_id.prod_date and not move_line.prod_date " t-field="move_line.lot_id.prod_date" t-options='{"widget": "date"}'/>
                    <span t-if="move_line.prod_date" t-field="move_line.prod_date" t-options='{"widget": "date"}'/></td>
            </t>
            <t t-if="has_expiry_date">
                <td><span t-if="move_line.lot_id.expiration_date  and not move_line.expiration_date" t-field="move_line.lot_id.expiration_date" t-options='{"widget": "date"}'/>
                    <span t-if="move_line.expiration_date" t-field="move_line.expiration_date" t-options='{"widget": "date"}'/></td>

            </t>
            <t t-if="has_batch_date">
                <td><span t-if="move_line.lot_id.suplier_lot and not move_line.suplier_lot" t-field="move_line.lot_id.suplier_lot"/>
                    <span t-if="move_line.suplier_lot" t-field="move_line.suplier_lot"/>
                    <span t-if="move_line.lot_id.ref" t-field="move_line.lot_id.ref"/></td>
            </t>
            <t t-if="public_price">
                <td><span t-field="move_line.product_id.pubprice"/>
                   </td>
            </t>

        </xpath>
    </template>

    <template id="stock_report_delivery_document_inherit_udates2" inherit_id="stock.report_delivery_document">
            <xpath expr="//div[@name='div_sched_date']" position="after">

                <div t-if="o.location_id.usage=='internal'" class="col-auto" name="from_location">
                            <strong>From:</strong>
                            <p t-field="o.location_id.name"/>
                        </div>
                <div t-if="o.location.usage=='internal' and o.location_id.usage !='internal'" class="col-auto" name="from_location">
                            <strong>From:</strong>
                            <p t-field="o.location.name"/>
                        </div>
                <div t-if="o.location_dest_id.usage=='internal'" class="col-auto" name="to_location">
                            <strong>To:</strong>
                            <p t-field="o.location_dest_id.name"/>
                        </div>

                <div t-if="o.location.usage=='internal' and o.location_dest_id.usage !='internal'" class="col-auto" name="to_location">
                            <strong>To:</strong>
                            <p t-field="o.location.name"/>
                        </div>
                <div t-if="o.state !='done'" class="col-auto" name="state">
                            <strong>State:</strong>
                            <p t-field="o.state"/>
                        </div>

            </xpath>

                 <xpath expr="//table[@name='stock_move_line_table']" position="after">
                        <div t-if="o.move_line_ids" class="mt32 ml64 mr4" name="total">
                        <div class="offset-8">
                            <strong>Total : <span  t-esc="sum(line.qty_done for line in o.move_line_ids)"/></strong>

                        </div>

                            </div>
                 </xpath>
                <xpath expr="//t[@t-if='o.backorder_ids and backorders']" position="replace">
                </xpath>
        </template>

     <template id="stock_report_delivery_document_inherit_udates2" inherit_id="stock.report_picking">
            <xpath expr="//div[@name='div_sched_date']" position="after">

                <div  class="col-auto" name="total">
                            <strong>Total:</strong>
                                        <p><span t-options='{"widget": "float", "precision": 0}' t-esc="sum(l.qty_done for l in o.move_line_ids)"/></p>
                        </div>
            </xpath>
            <xpath expr="//th[@name='th_serial_number']" position="after">

               <th name="th_pallet_number" class="text-center" t-if="has_serial_number">
                                           <strong>Pallet Location</strong>
                                        </th>
            </xpath> <xpath expr="//td[@t-if='has_serial_number']" position="replace">
  <td class=" text-center h6" t-if="has_serial_number">
 <span t-if="ml.lot_id" t-field="ml.lot_id"/>
 <span t-if="ml.lot_name and not ml.lot_id" t-field="ml.lot_name"/>
                                                </td>
         <td class=" text-center h6" t-if="has_serial_number">

 <span t-if="ml.lot_id.balet_ids" t-esc="', '.join(map(lambda x: (x.name), ml.lot_id.balet_ids))" />
 <span t-if="ml.balet_ids and not ml.lot_id" t-esc="', '.join(map(lambda x: (x.name), ml.balet_ids))" />
                                                </td>


            </xpath>


     </template>

</odoo>
